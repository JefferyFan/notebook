###概况
这周公司实习的事情比较忙。主要在做一个悬浮窗的东西，研究了一下安卓触摸事件的传递。
学到的知识点比较零散，在这写不清楚，大概说说。其他等我整理了Evernote 笔记再系统的分享分享～
大概说书安卓悬浮窗和半边结构，并分享一篇文章。​ 



###安卓悬浮窗
大概的效果是类似开启手机360后，回到桌面后，停靠在屏幕边缘的小窗口。
大概的步骤：

1. 调用Context.getSystemService(Context.WINDOW_SERVICE);获取WindowManager
2. 调用WindowManager.addView(View, WindowManager.LayoutParams)将窗口添加并显示
3. 重写触摸事件函数，实现拖动，按钮点击

这里涉及到Android触摸事件的传递过程。
当由触摸事件产生时，触摸事件将有顶层的View传递到最低端的View，再有最低端View开始处理触摸事件。

对于一个View：

 - dispatchTouchEvent(MotionEvent)最先接受收触摸事件，并在这个函数中分发触摸事件到子View中。
 - onInterceptTouchEvent(MotionEvent)用于截断触摸事件，当函数返回true时，触摸事件不再分发给子view
 - onTouchEvent(MotionEvent)用于处理触摸事件



 
###半边结构
看到网上有提到半边结构都是在说改进半边结构，分为几层几层，看的不是很明白。好不容易看了一些英文资料明白是怎么回事，就总结一下咯～

如下图，白线为网格模型的边，黄色的顶点为网格模型的顶点，蓝色为半边，黄色的箭头为指针。

![enter image description here][1]

从表示半边的结构讲起。

####**半边**
​半边是有方向的，每一条网格模型的边有两条半边，方向相反。
对于半边的方向不需要严格某种方向，只需要保证包围一个面的半边的方向是统一按照顺时针方向或者逆时针方向的就可以。​
那么，一个半边结构体需要保存的信息有：

1. 该半边指向的顶点
2. 该半边所相邻的面。一条网格模型的边与两个面相邻，但一条半边只与一个面相邻。  因此，可以由半边访问到半边相邻的面。
3. 该半边的下一条半边。下一条半边是指，以顺时针或者逆时针方向围着相邻面的下一条半边。上图是以顺时针为方向的。 因此，可以由一条半边，遍历该半边的相邻面的所有边。
4. 该半边的pair，即是与该半边方向相反的另一条边。

pair的作用是什么呢？
该半边的邻面和pair的邻面就是网格模型的一条边相邻的两个面！
那么也就是说，可以由一条半边，访问到网格模型的一条边的两个邻面。

```c++
typedef struct Edge {
    Vertex *start;
    Vertex *vertex;
    Edge *pair;
    Face *face;
    Edge *next;
} Edge;
```




####**顶点**
顶点结构当然先要保存顶点的坐标xyz，其次，可以额外保存该顶点的纹理坐标，法向量等信息。
另外，顶点还保存着一条由该顶点出发的半边。从该顶点出发的半边可能有很多很多条，但是只需要保存其中一条。具体的原理在后面解释。

```c++
typedef struct Vertex {
    float x;
    float y;
    float z;

    // 纹理坐标，法向量，边
    TextureCoordinate *tcoor;
    Normal *normal;
    Edge *edge;
} Vertex;
```

那么，顶点保存着有该顶点出发的半边，而半边保存着该半边指向的顶点（半边的结束点）。两个顶点共同构成了网格模型的一条边。
结合半边的pair指针，可以实现遍历与顶点相邻的顶点。 
```c++
Edge *e = vertex->edge;
do {
    Vertex *adjacentVertex = e->vertex;
    // process adjacent vertex
    e = e->pair->next;
} while(e != vertex->edge);
```
这个算法，画画图就很好理解了。  一个面的半边由next指针形成一个循环圈。




####**面**
实际上，面已经不需要保存很多信息了。只需要保存该面的其中一条半边就可以了。
有该面的其中一条半边，可以遍历该面的所有半边，也可以遍历该面的所有顶点，也有该面的所有半边，可以遍历所有的邻面。
```c++
typedef struct Face {
    Edge *edge;
} Face;
```


####**优势**

很明显，半边结构的优势非常明显。可以实现由一个顶点或者一条边或者一个面出发，查询相邻的顶点或者边或者面。而且，复杂度都是常数级的。
不足之处就是，半边结构只能用于表示 一条边只与两个面 相邻的网格模型。




###分享
最近看了一些心理学方面的文章，觉得讲的都很好啊！
为什么倾听很难？看了这篇文章，才明白按我们理解的倾听，很多时候其实都只能称之为反驳。
文章地址： http://zhuanlan.zhihu.com/lswlsw/19722879

另外，《一小时外》是李松蔚在知乎回答问题的集合，提到很多我们日常生活中会遇到的心理学方面的问题。讲的挺好的。  推荐推荐~
李松蔚，是北京大学心理学系的一个老师~
《一小时外》介绍：http://zhuanlan.zhihu.com/lswlsw/19751895


  [1]: http://www.flipcode.com/archives/article_halfedge.png