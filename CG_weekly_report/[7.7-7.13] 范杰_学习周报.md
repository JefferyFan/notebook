#软件设计文档



###一、软件简介
软件名称为SunRun。SunRun是一款跑酷游戏。



###二、软件设计

跑酷游戏最核心的是让人物跑动起来。人物跑动的同时需要进行一系列的交互，例如判断是否掉入下水道，是否吃到金币等。为了解决这一问题，将人物角色，道具，墙体(地面，垃圾桶等)抽象为RoleBase, MagicBase, WallBase。

人物角色采用状态管理的方式。


####**人物状态管理以及跑动逻辑 **
游戏过程中，人物的状态可以分为：


 - 准备状态，PREPARE
 - 站立状态，STAND
 - 跑动状态，RUN
 - 向上跳状态，JUMP_UP
 - 向下跳状态，JUMP_DOWN
 - 下滑状态，SLIDE
 - 死亡状态，DEAD

利用CCNode中的schedule函数，每一帧(0.016s)判断一次人物当前的状态，并作处理。

1.RUN状态逻辑：
a.如果右侧碰撞到墙体，更改状态为DEAD状态，结束
b.如果底部没碰撞到墙体，更改状态为JUMP_DOWN状态，结束
c.将人物向前移动xspeed（xspeed为人物对象创建时初始化的人物水平方向速度）的距离，更改人物的纹理为下一帧的纹理，结束。

2.JUMP_UP状态逻辑：
a.如果上方碰撞到墙体，将yspeed(yspeed是人物在垂直方向上的速度)设为0，并更改状态为JUMP_DOWN，结束
b.如果右侧碰撞到墙体，将状态更改为DEAD,结束
c.将人物向上移动yspeed的距离
d.yspeed = yspeed - accelerate. 如果yspeed<0，yspeed=0.(accelerate是人物创建时出示的垂直方向的加速度，相当于重力加速度)
e.将人物向前移动xspeed距离

3.JUMP_DOWN状态逻辑：
a.如果人物掉落出屏幕底部，状态改为DEAD，结束
b.如果人物底部碰撞到墙体，状态改为RUN，结束
c.如果人物右侧碰撞到墙体，xspeed = 0
f.将人物向下移动yspeed的距离
g.yspeed = yspeed + accelerate. 如果yspeed>oyspeed，yspeed=oyspeed. (oyspeed是人物创建时初始化的垂直方向的速度的最大值，也即是人物向上跳时的初始速度)
h.将人物向前移动xspeed距离

4.DEAD状态逻辑：
暂停人物，并添加OverLayer层到当前场景。


墙体碰撞判定
人物的跑动逻辑依赖于人物与墙体的是否碰撞。将墙体抽象成WallBase的好处是，可以将碰撞处理从人物角色中独立出来，方便添加一些音效。例如，当人物碰撞到垃圾桶时，播放碰撞的音效。

```cpp
bool WallBase::isCollided(CCRect box, int direction) {
	bool bFlag = false;
	switch(direction) {
	case COLLIDE_LEFT:
		bFlag = isCollideLeft(box);
		break;

	case COLLIDE_RIGHT:
		bFlag = isCollideRight(box);
		break;

	case COLLIDE_TOP:
		bFlag = isCollideTop(box);
		break;

	case COLLIDE_BOTTOM:
		bFlag = isCollideBottom(box);
		break;
	}
	return bFlag;
}
```



分为四个方向的碰撞，上下左右。
检测碰撞的原理很简单。







道具判定



三、后期改进